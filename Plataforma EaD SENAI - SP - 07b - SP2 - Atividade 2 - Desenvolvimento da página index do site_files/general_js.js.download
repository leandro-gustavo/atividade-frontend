/*! For license information please see general_js.js.LICENSE.txt */
(()=>{var e={808:(e,t,n)=>{var r,o;!function(i){if(void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o),!0,e.exports=i(),!!0){var s=window.Cookies,a=window.Cookies=i();a.noConflict=function(){return window.Cookies=s,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var s=JSON.stringify(n);/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var l in i)i[l]&&(a+="; "+l,!0!==i[l]&&(a+="="+i[l].split(";")[0]));return document.cookie=t+"="+n+a}}function s(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],s=0;s<i.length;s++){var a=i[s].split("="),l=a.slice(1).join("=");n||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var c=t(a[0]);if(l=(r.read||r)(l,c)||t(l),n)try{l=JSON.parse(l)}catch(e){}if(o[c]=l,e===c)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return s(e,!1)},o.getJSON=function(e){return s(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))}))},686:(e,t,n)=>{var r="[object Symbol]",o=/[&<>"'`]/g,i=RegExp(o.source),s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,a="object"==typeof self&&self&&self.Object===Object&&self,l=s||a||Function("return this")();var c,u=(c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==c?void 0:c[e]}),p=Object.prototype.toString,d=l.Symbol,f=d?d.prototype:void 0,g=f?f.toString:void 0;function m(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==r}(e))return g?g.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}e.exports=function(e){var t;return(e=null==(t=e)?"":m(t))&&i.test(e)?e.replace(o,u):e}},975:(e,t,n)=>{var r;!function(){"use strict";var o={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(e){return a(c(e),arguments)}function s(e,t){return i.apply(null,[e].concat(t||[]))}function a(e,t){var n,r,s,a,l,c,u,p,d,f=1,g=e.length,m="";for(r=0;r<g;r++)if("string"==typeof e[r])m+=e[r];else if("object"==typeof e[r]){if((a=e[r]).keys)for(n=t[f],s=0;s<a.keys.length;s++){if(null==n)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[s],a.keys[s-1]));n=n[a.keys[s]]}else n=a.param_no?t[a.param_no]:t[f++];if(o.not_type.test(a.type)&&o.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),o.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(i("[sprintf] expecting number but found %T",n));switch(o.number.test(a.type)&&(p=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}o.json.test(a.type)?m+=n:(!o.number.test(a.type)||p&&!a.sign?d="":(d=p?"+":"-",n=n.toString().replace(o.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(d+n).length,l=a.width&&u>0?c.repeat(u):"",m+=a.align?d+n+l:"0"===c?d+l+n:l+d+n)}return m}var l=Object.create(null);function c(e){if(l[e])return l[e];for(var t,n=e,r=[],i=0;n;){if(null!==(t=o.text.exec(n)))r.push(t[0]);else if(null!==(t=o.modulo.exec(n)))r.push("%");else{if(null===(t=o.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){i|=1;var s=[],a=t[2],c=[];if(null===(c=o.key.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s.push(c[1]);""!==(a=a.substring(c[0].length));)if(null!==(c=o.key_access.exec(a)))s.push(c[1]);else{if(null===(c=o.index_access.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");s.push(c[1])}t[2]=s}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return l[e]=r}t.sprintf=i,t.vsprintf=s,"undefined"!=typeof window&&(window.sprintf=i,window.vsprintf=s,void 0===(r=function(){return{sprintf:i,vsprintf:s}}.call(t,n,t,e))||(e.exports=r))}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(975),t=n(686),r=n.n(t);window.Blsm=window.Blsm||{},Blsm.isPlainObject=e=>"[object Object]"===Object.prototype.toString.call(e),window.lng=function(t,n){var o=[].slice.call(arguments);Blsm.isPlainObject(n)&&o.splice(1,1);var i=!1;if(n&&n.phrase){if(i=Blsm.InitialData&&Blsm.InitialData.phrases&&Blsm.InitialData.phrases[t])return n.replace&&(i=i.replaceAll("%s",n.replace)),r()(i);if(n.replace)return window.lng(t,n.replace)}o[0]=Blsm.translations&&Blsm.translations[t]||t,o[0].indexOf("|")>0&&(o[0]=o[0].split("|")[0]);try{return o.length>1?e.sprintf.apply(null,o):o[0]}catch(e){return console&&console.error&&console.error(e),o[0]}};const o={hasPermission:function(e){var t,n;return!!Blsm.user.isPowerManager||!(null===(t=Blsm.InitialData)||void 0===t||null===(n=t.permissions)||void 0===n||!n[e])},canAccessModule:function(e){var t=e.split("|");for(var n in t){var r,o;if(null!==(r=Blsm.InitialData)&&void 0!==r&&null!==(o=r.modules)&&void 0!==o&&o[t[n]])return!0}return!1},isFeatureEnabled:function(e){var t,n;return!(null===(t=Blsm.InitialData)||void 0===t||null===(n=t.features)||void 0===n||!n[e])},checkMod(e){var t;if(!e)return!0;const n={ENT:1,PRO:2}[e[1]];return(!e[0]||Blsm.isFeatureEnabled(e[0])||Blsm.canAccessModule(e[0]))&&(!n||n>=(null===(t=Blsm.InitialData)||void 0===t?void 0:t.plan))},isGuiFeatureEnabled:function(e){var t,n;return!(null===(t=Blsm.InitialData)||void 0===t||null===(n=t.gui_features)||void 0===n||!n[e])},GuiFeatureValue:function(e){var t,n;return null===(t=Blsm.InitialData)||void 0===t||null===(n=t.gui_features)||void 0===n?void 0:n[e]},ManagerPermissions:{MEMBERS_DIRECTOR:"members_director|1",CREATE_ASSIGNMENTS:"perm_assignments|1",SET_WEIGHTS:"perm_assignments|2",CREATE_MEETINGS:"perm_meetings|1",EDIT_MEETINGS:"perm_meetings|2",SET_ATTENDANCE:"perm_meetings|3",CONTENT_SHARE:"perm_content|1",VIEW_EVALUATIONS:"perm_evaluation|1",GRADES_MANAGEMENT:"perm_grades_management|1",CREATE_PORTAL:"perm_portal|1",GENERAL_CONFIG:"perm_config|1",VIEW:"view",MANAGE:"manage",GROUP_ACTIVE:"0",GROUP_MANAGERS_ONLY:"1",GROUP_INVISIBLE:"2"},CanUser:function(e,t,n){var r,o,i,s=null===(r=Blsm.InitialData)||void 0===r||null===(o=r.base_permissions)||void 0===o||null===(i=o[t])||void 0===i?void 0:i[e];return n?s&&s[n]:s&&s.no_options},GetDomainGeneralOption:function(e){var t,n;return null===(t=Blsm.InitialData)||void 0===t||null===(n=t.general_options)||void 0===n?void 0:n[e]}};var i=n(808);const s=function(e,t){if(!e)return e;t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(e,n){return t.indexOf("<"+n.toLowerCase()+">")>-1?e:""}))},a={cookies:n.n(i)(),csrf_get:function(){return Blsm.cookies.get("csrf_token")||""},local_storage:{set:function(e,t){try{if(void 0===t)return window.localStorage.removeItem(e,t);window.localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Storage error: "+e.message,"store cleared!"),window.localStorage.clear()}},get:function(e){const t=window.localStorage.getItem(e);try{return JSON.parse(t)}catch(e){return t}}},Match:function(e,t,n,r){if(!t)return source;n||(n={label:1}),r||(r={});var o,i,a=0;if(r.equals)for(i in n)a+=(t==(o=s(e[i]))?2:0)*n[i];else for(var l=!0,c=t.split(" "),u=0;u<c.length;u++){var p=!1,d=c[u],f=new RegExp(RegExp.escape(d),"i");for(i in n)a+=(d==(o=s(e[i]))?2:0)*n[i]+(f.test(o)?1:0)*n[i],p=p||f.test(o);l=l&&p}return!(!a||!l&&r.match_all)&&[a,e]},Filter:function(e,t,n,r){if(!t)return e;for(var o,i=[],s=[],a=0;a<e.length;a++)(o=this.Match(e[a],t,n,r))&&s.push(o);for(var l in s.sort((function(e,t){return t[0]-e[0]})),s)i.push(s[l][1]);return i},file_basename:function(e){return e.split(/[\/\\]/).pop()},file_extension:function(e){return e.substr(2+(~-e.lastIndexOf(".")>>>0))},file_is:function(e,t){let n=t&&Object.entries(Blsm.prm.mimetypes).find((e=>new RegExp(e[1]).test(t)));if(n)return n[0];let r=this.file_extension(e).toLowerCase();return n=r&&Object.entries(Blsm.prm.extensions).find((e=>e[1].indexOf(r)>=0)),n?n[0]:void 0},file_is_image:function(e){return"img"===this.file_is(e)},gen_random_string:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(var n=t,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)n+=r.charAt(Math.floor(Math.random()*r.length));return n},chat_with_group:function(e,t){window.bchat?window.bchat.chatWithGroup(e,t):Blsm.Error(lng("chat is disabled").caps())},hexToRgb:function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},isDarkContrast:function(e){var t=Blsm.hexToRgb(e);return Math.round((299*parseInt(t.r)+587*parseInt(t.g)+114*parseInt(t.b))/1e3)>125},loadJS:function(e){return e.reduce(((e,t)=>e.then((()=>{return e=t,new Promise(((t,n)=>{if(document.querySelector(`script[src="${e}"].ready`))return t();const r=document.createElement("script");r.src=e,r.onload=()=>{r.classList.add("ready"),t()},r.onerror=n,document.head.appendChild(r)}));var e}))),Promise.resolve())},download_content:(e,t,n)=>{const r={};if("csv"===a.file_extension(t))r.type="text/csv;charset=utf-8;";else r.type="text/plain;charset=utf-8;";const o=[e];n&&o.unshift("\ufeff");const i=new Blob(o,r);if(navigator.msSaveBlob)return navigator.msSaveBlob(i,t);const s=window.URL.createObjectURL(i),l=document.createElement("a");l.style.display="none",l.href=s,l.download=t,document.body.append(l),l.click(),window.URL.revokeObjectURL(s),l.remove()},table_to_csv:(e,t)=>{t=Object.assign({download_file_name:!1,cell_prep_cb:e=>e.innerText.trim(),exclude_rows:[],skip_invisible_rows:!0},t);const n=[],r=[],o={"=":1,"-":1,"+":1,"@":1},i=["thead","tbody","tfoot"].map((e=>`:scope > ${e} > tr`)).join(",");e.querySelectorAll(i).forEach(((e,i)=>{if(0===e.getClientRects().length)return;const s=[];let a=0;e.querySelectorAll(":scope > th, :scope > td").forEach(((e,n)=>{for(;r[a]>0;)r[a]--,s.push("..."),a++;const i=t.cell_prep_cb(e);if(s.push(1===o[i[0]]?"\t"+i:i),e.getAttribute("colspan")>1||e.getAttribute("rowspan")>1){const t=e.getAttribute("colspan")?e.getAttribute("colspan")-1:0,n=e.getAttribute("rowspan")?e.getAttribute("rowspan")-1:0;for(let e=a;e<=a+t;e++)e>a&&s.push("..."),r[e]=n;a+=t}a++})),n.push(s.filter(((e,n)=>!t.exclude_rows.includes(n))))}));const s=n.map((e=>e.map((e=>`"${e.toString().replace(/"/g,'""')}"`)).join(","))).join("\r\n");if(!t.download_file_name)return s;a.download_content(s,t.download_file_name,!0)}};var l=[],c=void 0;const u=function(e,t,n){e.pushManager&&e.pushManager.getSubscription().then((function(r){r?new Uint8Array(r.options.applicationServerKey).toString()!==n.toString()?r.unsubscribe().then((function(){u(e,t,n)})):l.push("existing sub "+JSON.stringify(r)):Notification.requestPermission((function(r){"granted"===r&&e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}).then((function(e){l.push("new sub "+JSON.stringify(e)),fetch((Blsm.prm.Mainref+"api?/Users/pwa_push_subscribe/"+t).csrf(),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.toJSON())}).catch((()=>e.unsubscribe.bind(e)))}))}))}))},p={init:function(e){if(!e.script)return console.err("pwa script missing");e.host===location.host&&(e.clear&&window.caches&&caches.keys().then((function(e){return Promise.all(e.map((function(e){return l.push("PWA cache clear: "+e),caches.delete(e)})))})),navigator.serviceWorker&&navigator.serviceWorker.register(Blsm.prm.Mainref+e.script).then((function(t){c=t,console.info("Service Worker Registered - "+e.script),e.clear?function(e){e.pushManager.getSubscription().then((function(e){e&&e.unsubscribe().then((function(){l.push("push notifications subscription removed")}))}))}(t):e.pushKey&&e.app&&u(t,e.app,function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}(e.pushKey))})).catch((function(e){console.error("Service Worker Error",e)})))},uninstall:function(){navigator.serviceWorker&&navigator.serviceWorker.getRegistrations().then((function(e){for(var t in e)0===location.href.indexOf(e[t].scope)&&e[t].unregister()}))},getRegistration:function(){return c},getLog:function(){return l}};var d=null,f=null;const g={favicon_dot:function(e){if(e){const e=document.querySelector("link[rel='shortcut icon']");if(null===d){d=e.getAttribute("href");var t=document.createElement("canvas");t.width=16,t.height=16;var n=t.getContext("2d"),r=new Image;r.crossOrigin="Anonymous",r.onload=function(){n.drawImage(r,0,0,16,16),n.beginPath(),n.arc(12,12,3.5,0,2*Math.PI),n.fillStyle="#ff9800",n.fill(),f=t.toDataURL("image/x-icon"),e.setAttribute("href",f)},r.src=d}else e.setAttribute("href",f)}else d&&document.querySelector("link[rel='shortcut icon']").setAttribute("href",d)},state_push:function(e,t){history.pushState&&(history.state&&history.state.dummy_for_dialog||(history.pushState({dummy_for_dialog:1},""),t&&e.listenToOnce(Backbone,"Window:popstate",t)))},state_remove:function(e){history.state&&history.state.dummy_for_dialog?(e&&Backbone.listenToOnce(Backbone,"Window:popstate",e),history.back()):e&&e()},isIE:function(){return navigator.userAgent.indexOf("Trident")>=0},isMobileSafari:function(){return navigator.userAgent.indexOf("iPhone")>=0&&navigator.userAgent.indexOf("CriOS")<0},group_access_options:()=>{let e={};return e[lng("controlled by managers").caps()]={private:lng("private").caps()+" - "+lng("owner only").caps(),manager_register:lng("departmental").caps()+" - "+lng("org' unit managers add their own users").caps()},Blsm.isFeatureEnabled("course_registartion")&&(e[lng("user registration").caps()]={public:lng("public").caps()+" - "+lng("anyone can join").caps(),register:lng("requested").caps()+" - "+lng("requires an approval sequence").caps()}),e},upload_files:function(e){const t=!!window.FormData,n=e=>{try{return JSON.parse(e)}catch(t){return e}},r=(e,n,o)=>{if(Blsm.isPlainObject(o)||Array.isArray(o))for(var i in o)r(e,n+"["+i+"]",o[i]);else t?e.append(n,o):e.append($("<input type='hidden'>").attr("name",n).val(o))};-1<e.url.indexOf("api?")&&0>e.url.indexOf("&csrf_token=?")&&Blsm.csrf_get()&&(e.url+="&csrf_token="+encodeURIComponent(Blsm.csrf_get())),Array.prototype.forEach.call(e.files,(o=>{if(o.id="dnduploadfile_"+Math.floor(999999*Math.random()),t){var i=new FormData;if(i.append("file",o),e.data)for(const[t,n]of Object.entries(e.data))r(i,t,n);const t=new XMLHttpRequest;t.open("POST",e.url),t.onload=()=>{4===t.readyState&&(200===t.status?e.on_complete&&e.on_complete(o,n(t.responseText)):e.on_error?e.on_error(o,n(t.responseText)):Blsm.Error(n(t.responseText)))},t.upload.onprogress=e.on_progress&&function(t){t&&t.lengthComputable&&e.on_progress(o,t.loaded/t.total*100|0)},e.on_start&&e.on_start(o,t),t.send(i)}else if(e.file_el){const t=e.file_el.cloneNode(!0);e.file_el.removeAttribute("id"),e.file_el.parentNode.appendChild(t);const i=document.createElement("iframe"),s="dndiframeupload_"+Math.floor(999999*Math.random());i.setAttribute("name",s),i.style.display="none";const a=document.createElement("form");if(a.setAttribute("method","post"),a.setAttribute("enctype","multipart/form-data"),a.setAttribute("target",s),a.setAttribute("action",e.url),a.appendChild(e.file_el),a.style.display="none",a.insertAdjacentHTML("beforeend",'<input type="hidden" name="ServiceStarter::$iframe" value="1"/>'),e.data)for(const[t,n]of Object.entries(e.data))r(a,t,n);a.appendChild(e.file_el);const l=document.getElementsByTagName("body")[0];l.appendChild(i),l.appendChild(a),i.onload=function(){const t=i.contentDocument.body.innerText;i.parentNode.removeChild(i),a.parentNode.removeChild(a),e.on_complete(o,n(t))},e.on_start&&e.on_start(o),a.submit()}}))},uploadFiles:function(e){const t=new FormData;if(-1<e.url.indexOf("api?")&&0>e.url.indexOf("&csrf_token=?")&&Blsm.csrf_get()&&(e.url+="&csrf_token="+encodeURIComponent(Blsm.csrf_get())),Array.prototype.forEach.call(e.files,((e,n)=>{e.id="upload"+Math.floor(999999*Math.random()),t.append(`file[${n}]`,e)})),e.data)for(const[n,r]of Object.entries(e.data))t.append(n,r);const n=new XMLHttpRequest;n.open("POST",e.url),n.onload=()=>{4===n.readyState&&(200===n.status?e.on_complete&&e.on_complete(n.responseText):e.on_error&&e.on_error(n.responseText))},n.upload.onprogress=e.on_progress&&function(t){t&&t.lengthComputable&&e.on_progress(t.loaded/t.total*100|0)},e.on_start&&e.on_start(file,n),n.send(t)},setJqueryAjaxPreFilter:function(){$.ajaxPrefilter((function(e,t,n){if(-1<e.url.indexOf("api?")){n.setRequestHeader("origin_hash",encodeURIComponent(window.location.hash));const t=Blsm.csrf_get();t&&n.setRequestHeader("X-CSRF-TOKEN",t);var r=$.deparam(location.search).assignment_token;r&&(e.url=e.url+"&assignment_token="+encodeURIComponent(r))}}))},lesson_type_lng:function(e){var t=Blsm.helpers.lesson_types().find((t=>t.value===e.toLowerCase()));return t&&t.label},lesson_types:function(){return[{value:"file",label:lng("file").caps()},{value:"test",label:lng("test").caps()},{value:"survey",label:lng("survey").caps()},{value:"courseware",label:lng("courseware").caps()},{value:"evaluation",label:lng("evaluation").caps()},{value:"form",label:lng("form").caps()},{value:"blog",label:lng("blog post").caps()},{value:"text",label:lng("text").caps()},{value:"certificate",label:lng("diplomas").caps()}]},setWindowError:function(e){window.onerror=function(t,n,r,o){if(console&&console.warn({errorMsg:t,url:n,lineNumber:r,colNumber:o}),t){n=n||"";var i=document.createElement("a");if(i.href=n,window.location.hostname===i.hostname){if(!_.find(["collaboration.js","collaboration_vendors.js","tinymce.min.js","vendors.js","jquery-ui","vendors.js","lib-jitsi-meet","external_api"],(function(e){return-1<n.indexOf(e)}))){["Failed to parse URL parameter value: undefined","ResizeObserver loop limit exceeded","ResizeObserver loop completed with undelivered notifications","Uncaught SyntaxError: Unexpected token <"].indexOf(t)>-1||e&&!n||Blsm.Error("JS "+t+" ("+r+":"+o+")")}}}}},setJqueryAjaxError:function(){$(document).ajaxError((function(e,t,n,r){if("abort"!==r&&console&&console.error("Error (ajax): ",e,t,n,r),!([0,404,502,503,504].indexOf(t.status)>-1)){if(!_.find(["/api?/notifications/","arrowchat","ipapi.co/"],(function(e){return-1<n.url.indexOf(e)})))if(t.responseJSON&&t.responseJSON.redirect)nav(t.responseJSON.redirect,{replace:!0});else{var o=t.responseJSON&&t.responseJSON.error_msg||t.responseText||lng("an error occurred");Blsm.prm.LOCALHOST&&t.responseJSON&&t.responseJSON.unexpected_output&&(o+=t.responseJSON.unexpected_output),Blsm.Error(lng("error").caps()+" ("+lng("server")+"): "+o.caps())}}})).ajaxComplete((function(e,t,n){if(200==t.status&&t.responseJSON&&t.responseJSON.res&&"1"!=t.responseJSON.res){var r=t.responseJSON.res||lng("an error occurred");Blsm.Error("ajaxComplete error: "+r.caps())}}))},setBackboneWrappers:function(e){Backbone.originalAjax=Backbone.ajax,Backbone.ajax=function(){return arguments[0].url=encodeURI(arguments[0].url),Backbone.originalAjax.apply(Backbone.$,arguments)},Backbone.originalSync=Backbone.sync,Backbone.sync=function(t,n,r){var o=_.isFunction(n.url)?n.url():n.url;return o&&(r=r||{},o.startsWith(e)||(r.url=e+o)),Backbone.originalSync(t,n,r)}},get_targets:function(e,t,n){return{user:(e||lng("user")).caps(),manager:lng("%s's direct manager",e).caps(),users_indirect_manager:lng("%s's indirect manager",e).caps(),users_managers_manager:lng("%s's manager's manager",e).caps(),user_professional_manager:lng("%s's professional manager",e).caps(),user_hr_manager:lng("%s's human resources coordinator",e).caps(),personal_coach:lng("%s's personal coach",e).caps(),...n&&{coach:lng("%s's assigned coach",e).caps()},...(void 0===t||t)&&{other:lng("users, roles, workspaces").caps(!1)}}}};lng("off"),lng("immediate"),lng("minutes"),lng("minutes"),lng("hour"),lng("hours"),lng("hours"),lng("hours"),lng("day"),lng("days");String.prototype.csrf=function(){if(this.includes("&csrf_token="))return this;const e=Blsm.csrf_get();return e?this+"&csrf_token="+encodeURIComponent(e):this},String.prototype.caps=function(e){return this.replace(!1!==e?/^(.)/:/(?:^'?|\s'?)\S/g,(function(e){return e.toUpperCase()}))},String.prototype.truncate=function(e,t){return!e||this.length<=e?this:this.substring(0,e-1).trim()+(t||"…")},String.prototype.nl2br=function(){return this.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")},String.prototype.br2nl=function(){return this.replace(/<br\s*\/?>/gm,"\n")},String.prototype.taskify=function(){return this.replace(/(\s|^|>)T#(\d+)(\s|$|,|<|\.)/g,'$1<a href="#edit/task/$2">T#$2</a>$3')},String.prototype.linkify=function(e){const t=Autolinker.link(this,{stripPrefix:!1});if(!e)return t;const n=document.createElement("div");return n.innerHTML=t,n.querySelectorAll("a").forEach((e=>{let t=new URLSearchParams(e.search);if(e.classList.contains("attached-file")){const t=e.search.substring(e.search.indexOf("name=")+5);e.innerText=decodeURIComponent(t)}let n=Blsm.file_extension(t.get("name")||"").toLowerCase();if("mp4"===n||"mov"===n)e.setAttribute("data-preview","mp4");else if(["csv","xls","xlsx","txt","pdf"].includes(n))e.setAttribute("data-preview",n);else if(Blsm.file_is_image(e.pathname)||e.pathname.includes("GetFile")&&Blsm.file_is_image(e.search))e.setAttribute("data-preview","img"),/https?:/i.test(e.innerHTML)&&(e.innerHTML=`<img src="${e.href}" title="${e.href.indexOf("/GetFile?")?"":e.href}" style="display:block;" />`);else{const t=(e=>{let t=(e=decodeURIComponent(e)).match(/&name=([%\w\-\.]+\.\w{2,4})($|&)/);return t?t[1]:(t=e.match(/&([%\w\-\.]+\.\w{2,4})$/),t?t[1]:void 0)})(e.search);t&&/https?:/i.test(e.innerHTML)&&(e.innerHTML=`<span class="icon icon-attachment" ></span> ${t}`)}})),n.querySelectorAll("img:not(.emojione)").forEach((e=>{if(e.closest("a"))return;const t=document.createElement("a");t.href=e.src,t.dataset.preview="img",t.append(e.cloneNode(!0)),e.replaceWith(t)})),n.innerHTML},String.prototype.emojify=function(){return emojione.ascii=!0,emojione.toImage(this)},String.prototype.emoji_prepare=function(){return this},String.prototype.emoji_edit=function(){return emojione.ascii=!1,emojione.shortnameToUnicode(this)},String.prototype.comment_markup=function(){let e=this.replace(/\r/g,"").replace(/(\s|^)\*([^*\n]*)\*(\s|$|,|\.)/gm,"$1<b>$2</b>$3").replace(/(\s|^)_([^_\n]*)_(\s|$|,|\.)/gm,"$1<u>$2</u>$3").replace(/(\s|^)`([^`\n]*)`(\s|$|,|\.)/gm,"$1<i>$2</i>$3").replace(/(\s|^)~([^~\n]*)~(\s|$|,|\.)/gm,"$1<s>$2</s>$3").replace(/(\s|^)!([^!\n]*)!(\s|$|,|\.)/gm,'$1<span style="color:#FF0042;">$2</span>$3').replace(/(\s|^|>)T#(\d+)(\s|$|,|<|\.)/g,'$1<a href="#edit/task/$2">T#$2</a>$3');return e=e.replace(/^[#-](.*)(\n|$)/gm,(function(e,t){return"#"===e.charAt(0)?"<ol><li>"+t+"</li></ol>":"<ul><li>"+t+"</li></ul>"})).replace(/(<\/ul><ul>|<\/ol><ol>)/g,""),e},String.prototype.mentions=function(e){return this.replace(/@\[#(\d+)\/([^\]]+)\]/g,e?"@$2":'<span class="mentions_box">@$2</span>')},String.prototype.stripTags=function(){return this.br2nl().replace(/<[^>]*>/gi,"")},String.prototype.isRtl=function(){const e=document.createElement("div");e.append(this);return/[\u0591-\u07FF]/.test(e.innerText.replace(/^[\s!-@[-`{-\u00bf\u1ffd-\u208f\u20a0-\u2bff]+/g,"").charAt(0))},String.prototype.repeat||(String.prototype.repeat=function(e){return new Array(e+1).join(this)});const m=e=>{(e=e.replace(location.pathname,"")).startsWith("/")||(e="/"+e),e.startsWith("/api?")&&(e=e.replace(/[/]api\?[/]/,"/api/"));const t=e.split("/"),n=[];let r=!1,o=0;for(let e of t)e&&(r||!/=/.test(e)&&!Number.isFinite(parseInt(e))||(r=1),r&&(o++,/=/.test(e)||(e="p"+o+"="+e)),n.push((r?o>1?"&":"?":"/")+e));return n.join("")},h=e=>e?("(blossom support)"===e.user_last_name?"blsm_":"")+(e.isAdmin?"admin":e.isPowerManager?"power":e.isManager?"manager":"user"):"";RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Object.assign(Blsm,o,a,{PWA:p},{helpers:g},{GTag:class{constructor(e){this.token=e,window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)},gtag("js",new Date),document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("hashchange",(()=>this.pageview())),this.pageview()}))}sendApi(e,t,n,r){if("GET"!==t&&void 0===(null==n?void 0:n.term)&&!e.startsWith("ajax")){var o,i;if(t&&(e+=`/method=${t}`),e.startsWith("import/")&&n&&(e+="/action="+(n.commit?"commit":"preview")),r)200!==r.status&&(e+=`/status=${r.status}`),null!==(o=r.responseJSON)&&void 0!==o&&o.res&&(e+=`/res=${r.responseJSON.res}`),null!==(i=r.responseJSON)&&void 0!==i&&i.error_msg&&(e+=`/error_msg=${r.responseJSON.error_msg}`);this.__send(m(e))}}pageview(){/\/(Launcher$)/.test(location.pathname)?this.__send(location.pathname+location.search):this.__send(m("/"+location.hash.toString().substring(1)))}__send(e){var t,n,r,o,i,s;!this.CDrunonce&&"undefined"!=typeof Blsm&&Blsm.prm&&(gtag("set","undefined"==typeof Blsm?{}:{server_name:(null===(t=Blsm.prm)||void 0===t?void 0:t.server_name)||null,domain_id:(null===(n=Blsm.user)||void 0===n?void 0:n.domain_id)||null,user_type:h(Blsm.user)||null,pretender_user_type:h(null===(r=Blsm.user)||void 0===r?void 0:r.real_data)||null,branch:(null===(o=Blsm.prm)||void 0===o||null===(i=o.revision)||void 0===i?void 0:i.branch)||null,user_id:(null===(s=Blsm.user)||void 0===s?void 0:s.user_id)||null}),this.token.split(",").forEach((e=>gtag("config",e))),this.CDrunonce=1),e&&gtag("event","page_view",{page_location:location.protocol+"//"+location.hostname+e})}}}),Blsm.beacon=(e,t)=>{e.includes("api?")&&(e=e.csrf());const n=new FormData;for(let e in t)n.append(e,t[e]);navigator.sendBeacon?!1===navigator.sendBeacon(e,n)&&console.error("navigator.sendBeacon failed!"):fetch(e,{method:"POST",body:n})},window.addEventListener("DOMContentLoaded",(()=>{if(!(Blsm.prm.inactivity_logout>0&&Blsm.user.id>0))return;let e=0;window.localStorage.setItem("last_activity",(new Date).getTime());const t=()=>{const t=(new Date).getTime();t>e+1e3&&(e=t,window.localStorage.setItem("last_activity",t))};window.addEventListener("scroll",t),window.addEventListener("click",t),window.addEventListener("keydown",t);const n=()=>{document.cookie.includes("user_ses_ext=1")||fetch(Blsm.prm.Mainref+"api?/login/extend_session".csrf(),{method:"POST"})};n(),setInterval(n,6e4)}))})()})();